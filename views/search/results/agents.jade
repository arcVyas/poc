doctype html
html
  head
    meta(charset='utf-8')
    title Demo App
    meta(name='description', content='This was generated by the Codeply editor and responsive design playground.')
    meta(name='viewport', content='width=device-width, initial-scale=1.0')
    meta(name='generator', content='Codeply')
    link(rel='stylesheet', href='//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha/css/bootstrap.min.css')
    link(href='//cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css', rel='stylesheet')
    link(rel='stylesheet', href='http://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css')
    link(rel='stylesheet', href='https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css')
    link(rel='stylesheet', href='/css/styles.css')
  body.bg-faded(id="body-agents")
  
    nav#topNav.navbar.navbar-default.navbar-fixed-top
      .container
        button.navbar-toggler.hidden-md-up.pull-right(type='button', data-toggle='collapse', data-target='#collapsingNavbar')
          | ☰
        a.navbar-brand.page-scroll(href='/poc/scheduler-app/search') Scheduler App
        #collapsingNavbar.collapse.navbar-toggleable-sm
          ul.nav.navbar-nav
            li.nav-item
              a.nav-link.page-scroll(href='/poc/scheduler-app/search#one') Shop Services
            li.nav-item
              a.nav-link.page-scroll(href='/poc/scheduler-app/reservations') My Appointments
            li.nav-item
              a.nav-link.page-scroll(href='#') More
          ul.nav.navbar-nav.pull-right
            li.nav-item
              a.nav-link.page-scroll(data-toggle='modal', title='Change Zip', href='#changeZipModal') Zip 10003 (Change)
            li.nav-item
              a.nav-link.page-scroll(data-toggle='modal', title='About', href='#aboutModal') About

    section#two
      .container.wow.fadeInUp(id="main-container")
        h4 We found below agents to install your Nest
        - console.log("vyas:"+data)
        - var agents = data.agents
        - console.log("vyas.agents"+ agents)

        br
        .row.col-sm-12(align="right")
          span(text-align="right", style="font-size:12px")
            | Filter
            i.fa.fa-lg.fa-fw.fa-plus-circle(id="filterIcon", align="right")
        br
        .card(id="searchBox")
          .card-block(align="left")
            .row
              .col-lg-2
                .card(align="center", style="border:none;")
                  .card-block.checkbox
                    label
                      input(type="checkbox", checked="checked")
                      |   Favorites
              .col-lg-2
                .card(align="center", style="border:none;")
                  .card-block.checkbox
                    label
                      input(type="checkbox", value="selected")
                      |   Available now
              .col-lg-3
                .card(align="center", style="border:none;")
                  .card-block.dropdown
                    button#dropdownMenu1.btn.btn-secondary.dropdown-toggle(type='button', data-toggle='dropdown', aria-haspopup='true', aria-expanded='false')
                      | Preferred Time slot
                    .dropdown-menu(aria-labelledby='dropdownMenu1')
                      a.dropdown-item No Preference
                      a.dropdown-item Select Time Slot
              .col-lg-3
                .card(align="center", style="border:none;")
                  .card-block.dropdown
                    button#dropdownMenu1.btn.btn-secondary.dropdown-toggle(type='button', data-toggle='dropdown', aria-haspopup='true', aria-expanded='false')
                      | Sort By
                    .dropdown-menu(aria-labelledby='dropdownMenu1')
                      a.dropdown-item Rating
                      a.dropdown-item Skill Level
              .col-lg-2
                .card(align="center", style="border:none;")
                  .card-block.a.btn.btn-primary-outline.btn-lg.page-scroll.wow.fadeInUp(href='/poc/scheduler-app/search') 
                    i.fa.fa-search
        br
        // FAVOURTIES
        .card
          .card-header(style="background:lightblue;")
            i.fa.fa-fw.fa-heart
            | Favorites
            
          .card-block
            .row
              each agent in agents.favorites
                .col-lg-4
                  .card(id="agentCard"+agent.id)
                    .card-block
                      .row
                        .col-sm-4
                          img(src='#{agent.photolink}',class="img-rounded", width="100" height="100")
                        .col-sm-8(style="vertical-align: middle;")
                          h4.card-title.text-xs-right
                            | #{agent.name}
                            br
                            i.fa.fa-fw.fa-heart
                    ul.list-group.list-group-flush(style="font-size:12px")
                      li.list-group-item Services Completed:  #{agent.servicesCompleted}
                      li.list-group-item
                        | Rating - 
                        - var norating = 5-agent.rating
                        span(style="color:#FFE200;font-size:15px", repeat="#{agent.rating}") ★
                        span(style="color:lightgray;font-size:15px",repeat="#{norating}") ☆
                          
                      li.list-group-item(style="background:lightgray;") Available in #{agent.wait} hours
                    p.card-footer.text-muted(align="center")
                      a.btn.btn-primary-outline.btn-sm.page-scroll.wow.fadeInUp(href='javascript:createReservationWrapper(#{agent.id})') Make Appointment
        br
        
        // AVAILABLE now
        .card
          .card-header(id="availableCard-Header",style="background:lightgreen;")
            | Available now (2)
          .card-block
            .row
              each agent in agents.availableNow
                .col-lg-4(id="sneakInCard"+agent.id)
                  .card(id="agentCard"+agent.id)
                    .card-block
                      .row
                        .col-sm-4
                          img(src='#{agent.photolink}',class="img-rounded", width="100" height="100")
                        .col-sm-8(style="vertical-align: middle;")
                          h4.card-title.text-xs-right #{agent.name}
                    ul.list-group.list-group-flush(style="font-size:12px")
                      li.list-group-item Services Completed:  #{agent.servicesCompleted}
                      li.list-group-item
                        | Rating - 
                        - var norating = 5-agent.rating
                        span(style="color:#FFE200;font-size:15px", repeat="#{agent.rating}") ★
                        span(style="color:lightgray;font-size:15px",repeat="#{norating}") ☆
                      li.list-group-item(style="background:lightgreen;") 
                        | Available Now &nbsp;&nbsp;
                        i.fa.fa-hand-paper-o
                    p.card-footer.text-muted(align="center")
                      a.btn.btn-primary-outline.btn-sm.page-scroll.wow.fadeInUp(href='javascript:createReservationWrapper(#{agent.id})') Make Appointment
        br
        // More Agents
        .card
          .card-header(style="background:cyan;")
            | More Agents to choose from..
          .card-block
            .row
              each agent in agents.moreAgents
                .col-lg-4
                  .card(id="agentCard"+agent.id)
                    .card-block
                      .row
                        .col-sm-4
                          img(src='#{agent.photolink}',class="img-rounded", width="100" height="100")
                        .col-sm-8(style="vertical-align: middle;")
                          h4.card-title.text-xs-right #{agent.name}
                          h6.text-xs-right #{agent.vendor}
                            
                    ul.list-group.list-group-flush(style="font-size:12px")
                      li.list-group-item Services Completed:  #{agent.servicesCompleted}
                      li.list-group-item
                        | Rating - 
                        - var norating = 5-agent.rating
                        span(style="color:#FFE200;font-size:15px", repeat="#{agent.rating}") ★
                        span(style="color:lightgray;font-size:15px",repeat="#{norating}") ☆
                      li.list-group-item(style="background:lightgray;") Available in #{agent.wait} hours
                    p.card-footer.text-muted(align="center")
                      a.btn.btn-primary-outline.btn-sm.page-scroll.wow.fadeInUp(href='javascript:createReservationWrapper(#{agent.id})') Make Appointment

        br
        .row.col-lg-12(align="center")
          a.btn.btn-primary-outline.btn-lg.page-scroll.wow.fadeInUp(href='javascript:showSearch()') Search Again
          
    footer#footer
      .container
        br
        span.pull-right.text-muted.small
          a(href='') Demo App
          |  ©2015 Company
    #galleryModal.modal.fade(tabindex='-1', role='dialog', aria-hidden='true')
      .modal-dialog
        .modal-content
          .modal-body
            img#galleryImage.center-block.img-responsive(src='//placehold.it/1200x700/222?text=...')
            p
              br
              button.btn.btn-primary.btn-lg.center-block(data-dismiss='modal', aria-hidden='true')
                | Close
                i.ion-android-close
    #aboutModal.modal.fade(tabindex='-1', role='dialog', aria-hidden='true')
      .modal-dialog
        .modal-content
          .modal-body
            h2.text-center Demo App
            h6.text-center Yup, just a demo app
            p.text-center
              | See ya..
            br
            button.btn.btn-primary.btn-lg.center-block(data-dismiss='modal', aria-hidden='true')
              | OK
    #changeZipModal.modal.fade(tabindex='-1', role='dialog', aria-hidden='true')
      .modal-dialog
        .modal-content
          .modal-body
            h2.text-center Change zip code
            h6.text-center System automatically identifies the zip based on IP
            p.text-center
              | Users can change it (not implemented in demo)
            br
            button.btn.btn-primary.btn-lg.center-block(data-dismiss='modal', aria-hidden='true')
              | OK
    #alertModal.modal.fade(tabindex='-1', role='dialog', aria-hidden='true')
      .modal-dialog.modal-sm
        .modal-content
          .modal-body
            h2.text-center Nice Job!
            p.text-center
              | You clicked the button, but it doesn't actually go anywhere because this is only a demo.
            p.text-center
              a(href='http://www.bootstrapzero.com') Learn more at BootstrapZero
            br
            button.btn.btn-primary.btn-lg.center-block(data-dismiss='modal', aria-hidden='true')
              | OK
              i.ion-android-close
    // scripts loaded here
    script(src='//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js')
    script(src='//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha/js/bootstrap.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.js')
    script(src='/js/scripts.js')
    script(src='/js/spin.js')
    script.
      var spinner
      var newIdGenerated
      $( document ).ready(function() {
        $("[id ^=agentCard]").css( "box-shadow", "10px 10px 5px grey");
        $("#sneakInCard4").hide()
        $("#searchBox").hide()
        setTimeout(showAvailable,5000)
        $("#filterIcon").click(function(){
          if($(this).hasClass("fa-plus-circle")){
            $("#searchBox").show()
            $(this).removeClass("fa-plus-circle")
            $(this).addClass("fa-minus-circle")
          }else{
            $("#searchBox").hide()
            $(this).removeClass("fa-minus-circle")
            $(this).addClass("fa-plus-circle")
          }
        });
        $('[repeat]').each(function() {
           var toRepeat = $(this).text();
           var times = parseInt($(this).attr('repeat'));
           var repeated = Array(times+1).join(toRepeat);
           $(this).text(repeated).removeAttr('repeat');
        });
          
      });
      function startSpinner(tgt){
        var opts = {
          lines: 13 // The number of lines to draw
        , length: 28 // The length of each line
        , width: 14 // The line thickness
        , radius: 42 // The radius of the inner circle
        , scale: 1 // Scales overall size of the spinner
        , corners: 1 // Corner roundness (0..1)
        , color: '#000' // #rgb or #rrggbb or array of colors
        , opacity: 0.25 // Opacity of the lines
        , rotate: 0 // The rotation offset
        , direction: 1 // 1: clockwise, -1: counterclockwise
        , speed: 1 // Rounds per second
        , trail: 80 // Afterglow percentage
        , fps: 20 // Frames per second when using setTimeout() as a fallback for CSS
        , zIndex: 2e9 // The z-index (defaults to 2000000000)
        , className: 'spinner' // The CSS class to assign to the spinner
        , top: '50%' // Top position relative to parent
        , left: '50%' // Left position relative to parent
        , shadow: true // Whether to render a shadow
        , hwaccel: false // Whether to use hardware acceleration
        , position: 'absolute' // Element positioning
        }
        var target = document.getElementById(tgt)
        if(spinner==null){
          spinner= new Spinner(opts).spin(target)
        }
        else {
          spinner.spin(target)
        }
      }
      function createReservationWrapper(agentId){
        newIdGenerated=0
        startSpinner("agentCard"+agentId)
        console.log("spin started")
        createReservation(agentId)
      }
      function createReservation(agentId){
        $.post("/poc/scheduler-app/reservations/create?agentId="+agentId,
        {},
        function(data, status){
          console.log(data + ":" + status)
          if(status=="success"){
            newIdGenerated=data
            setTimeout(redirect,2000)
          }else {
            console.log ("Brr.... Error")
          }
        });
        
      }
      function redirect(){
        spinner.stop()
        window.location.href="/poc/scheduler-app/reservations/"+newIdGenerated
      }
      function showAvailable(){
        $("#sneakInCard4").show()
        $("#availableCard-Header").text("Available now")
      }
      function showSearch(){
        $("#searchBox").show()
        if(!$("#filterIcon").hasClass("fa-minus-circle")){
          $("#filterIcon").removeClass("fa-plus-circle")
          $("#filterIcon").addClass("fa-minus-circle")
        }
        window.location.href = '#two';
      }
      $("[id ^=agentCardxxx]").hover(
        function() {
          $( this ).css( "box-shadow", "none");
        }, function() {
          $( this ).css( "box-shadow", "20px 20px 5px grey");
        }
      );
      
