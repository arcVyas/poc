doctype html
html
  head
    meta(charset='utf-8')
    title Demo App
    meta(name='description', content='This was generated by the Codeply editor and responsive design playground.')
    meta(name='viewport', content='width=device-width, initial-scale=1.0')
    meta(name='generator', content='Codeply')
    link(rel='stylesheet', href='//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha/css/bootstrap.min.css')
    link(href='//cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css', rel='stylesheet')
    link(rel='stylesheet', href='http://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css')
    link(rel='stylesheet', href='https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css')
    link(rel='stylesheet', href='/css/styles.css')

  body.bg-faded
    
    nav#topNav.navbar.navbar-default.navbar-fixed-top
      .container
        button.navbar-toggler.hidden-md-up.pull-right(type='button', data-toggle='collapse', data-target='#collapsingNavbar')
          | ☰
        a.navbar-brand.page-scroll(href='/poc/scheduler-app/search') Scheduler App
        #collapsingNavbar.collapse.navbar-toggleable-sm
          ul.nav.navbar-nav
            li.nav-item
              a.nav-link.page-scroll(href='/poc/scheduler-app/search#one') Shop Services
            li.nav-item
              a.nav-link.page-scroll(href='/poc/scheduler-app/reservations') My Appointments
            li.nav-item
              a.nav-link.page-scroll(href='#') More
          ul.nav.navbar-nav.pull-right
            li.nav-item
              a.nav-link.page-scroll(data-toggle='modal', title='Change Zip', href='#changeZipModal') Zip 10003 (Change)
            li.nav-item
              a.nav-link.page-scroll(data-toggle='modal', title='About', href='#aboutModal') About

    section#one
      .container.wow.fadeInUp
        .card(id="reservationCard")
          - var color 
          - var resId = data.id
          - if(data.appointment.status=="draft"){
          -   color="lightyellow"
          -   resId=""
          - }else if(data.appointment.status=="confirmed"){
          -   color="lightgreen"
          - }else if(data.appointment.status=="cancelled"){
          -   color="lightred"
          - }else{
          -   color="darkgray"
          - }
          .card-header(id="reservationCard-header",style="background:#{color};")
            | Appointment - #{resId}
          .card-block
            .card-title 
              .row
                .col-sm-6(align="left")
                  span(text-align="left") Nest Thermostat Installation over phone
                .col-sm-6(align="right")
                  span(text-align="right") ... $99.99
            br
            .row
              .col-sm-4
                .card
                  .card-header(style="background:lightblue;")
                    | Customer
                  .card-block
                    .card-title Ross Geller
                    .card-text(align="left",style="font-size:12px;")
                      | Greenwich Village
                      br
                      | Apt 20
                      br
                      | NY 10003
                      br
                      | 612-222-7657
              .col-sm-4
                .card
                  .card-header(style="background:lightblue;")
                    | Agent
                  .card-block
                    .card-title 
                      img(src='#{data.agent.photolink}',class="img-rounded", width="50" height="50")
                      | &nbsp;&nbsp; #{data.agent.name}
                    .card-text(align="left",style="font-size:12px;") Bestbuy Geek Squad Agent
                    .card-text(align="left",style="font-size:12px;") Services Completed: #{data.agent.servicesCompleted}
                    .card-text(align="left",style="font-size:12px;") 
                      - var norating = 5-data.agent.rating
                      span(style="color:#FFE200;font-size:15px", repeat="#{data.agent.rating}") ★
                      span(style="color:lightgray;font-size:15px",repeat="#{norating}") ☆
                    .card-text(align="left",style="font-size:12px;") Your last service with #{data.agent.name}: Mar 13 2015
              .col-sm-4
                .card
                  .card-header(style="background:lightblue;")
                    | Appointment
                  .card-block
                    .card-title(align="right") #{data.appointment.date}
                      br
                      span(style="font-size:10px;") Estimated Service time: 60 minutes
                    .card-text(align="right",style="font-size:12px;") 
                      | Choose a different slot &nbsp;&nbsp;
                      i.fa.fa-calendar      

          .card-footer
            .row
              .col-sm-12(align="right")
                a.btn.btn-primary-outline.btn-lg.page-scroll.wow.fadeInUp(id="confirmAppt", href='javascript:confirmAppt()',style="margin: 10px;") Confirm Appointment 
                a.btn.btn-primary-outline.btn-lg.page-scroll.wow.fadeInUp(id="cancel", href='/poc/scheduler-app/services/SR12345/agents') Close
    footer#footer
      .container
        br
        span.pull-right.text-muted.small
          a(href='') Demo App
          |  ©2015 Company
    #galleryModal.modal.fade(tabindex='-1', role='dialog', aria-hidden='true')
      .modal-dialog
        .modal-content
          .modal-body
            img#galleryImage.center-block.img-responsive(src='//placehold.it/1200x700/222?text=...')
            p
              br
              button.btn.btn-primary.btn-lg.center-block(data-dismiss='modal', aria-hidden='true')
                | Close
                i.ion-android-close
    #aboutModal.modal.fade(tabindex='-1', role='dialog', aria-hidden='true')
      .modal-dialog
        .modal-content
          .modal-body
            h2.text-center Demo App
            h6.text-center Yup, just a demo app
            p.text-center
              | See ya..
            br
            button.btn.btn-primary.btn-lg.center-block(data-dismiss='modal', aria-hidden='true')
              | OK
    #changeZipModal.modal.fade(tabindex='-1', role='dialog', aria-hidden='true')
      .modal-dialog
        .modal-content
          .modal-body
            h2.text-center Change zip code
            h6.text-center System automatically identifies the zip based on IP
            p.text-center
              | Users can change it (not implemented in demo)
            br
            button.btn.btn-primary.btn-lg.center-block(data-dismiss='modal', aria-hidden='true')
              | OK
    #alertModal.modal.fade(tabindex='-1', role='dialog', aria-hidden='true')
      .modal-dialog.modal-sm
        .modal-content
          .modal-body
            h2.text-center Nice Job!
            p.text-center
              | You clicked the button, but it doesn't actually go anywhere because this is only a demo.
            p.text-center
              a(href='http://www.bootstrapzero.com') Learn more at BootstrapZero
            br
            button.btn.btn-primary.btn-lg.center-block(data-dismiss='modal', aria-hidden='true')
              | OK
              i.ion-android-close
    // scripts loaded here
    script(src='//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js')
    script(src='//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha/js/bootstrap.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.js')
    script(src='/js/scripts.js')
    script(src='/js/spin.js')
    script.
      var spinner
      var cancel=false
      $( document ).ready(function() {
        $('[repeat]').each(function() {
           var toRepeat = $(this).text();
           var times = parseInt($(this).attr('repeat'));
           var repeated = Array(times+1).join(toRepeat);
           $(this).text(repeated).removeAttr('repeat');
        });
        if("#{data.appointment.status}"=="draft"){
          $("#confirmAppt").text("Confirm Appointment");
        }else if("#{data.appointment.status}"=="confirmed"){
          $("#confirmAppt").text("Cancel Appointment");
          $("#cancel").attr("href",'/poc/scheduler-app/reservations')
        }else if("#{data.appointment.status}"=="completed"){
          $("#confirmAppt").text("Rate us");
          $("#cancel").attr("href",'/poc/scheduler-app/reservations')
        }else if("#{data.appointment.status}"=="cancelled"){
          $("#confirmAppt").hide();
          $("#cancel").attr("href",'/poc/scheduler-app/reservations')
        }
      });
      function confirmAppt(){
        var text = "Confirming"
        if("#{data.appointment.status}"=="confirmed" || cancel){
          text = "Cancelling"
        }
        $("#reservationCard-header").text(text+ " appointment")
        $("#confirmAppt").text(text+"..");
        startSpinner()
        setTimeout(finish, 2000);
      }
      function finish(){
        var operation ="confirm"
        var color = "lightgreen"
        var hide = false
        var text = "confirmed"
        if("#{data.appointment.status}"=="confirmed" || cancel){
          operation="cancel"
          color = "red"
          hide=true
          text = "cancelled"
        }
        $.post("/poc/scheduler-app/reservations/#{data.id}/"+operation,
        {},
        function(data, status){
          $("#reservationCard-header").css("background",color)
          $("#reservationCard-header").text("Appointment #{text} - #{data.id}")
          $("#confirmAppt").text("Cancel Appointment");
          $("#confirmAppt").blur()
          if(hide){
            $("#confirmAppt").hide()
          }
          cancel=true
        });
        spinner.stop()
      }
      function startSpinner(){
        var opts = {
          lines: 13 // The number of lines to draw
        , length: 28 // The length of each line
        , width: 14 // The line thickness
        , radius: 42 // The radius of the inner circle
        , scale: 1 // Scales overall size of the spinner
        , corners: 1 // Corner roundness (0..1)
        , color: '#000' // #rgb or #rrggbb or array of colors
        , opacity: 0.25 // Opacity of the lines
        , rotate: 0 // The rotation offset
        , direction: 1 // 1: clockwise, -1: counterclockwise
        , speed: 1 // Rounds per second
        , trail: 80 // Afterglow percentage
        , fps: 20 // Frames per second when using setTimeout() as a fallback for CSS
        , zIndex: 2e9 // The z-index (defaults to 2000000000)
        , className: 'spinner' // The CSS class to assign to the spinner
        , top: '50%' // Top position relative to parent
        , left: '50%' // Left position relative to parent
        , shadow: true // Whether to render a shadow
        , hwaccel: false // Whether to use hardware acceleration
        , position: 'absolute' // Element positioning
        }
        var target = document.getElementById('reservationCard')
        if(spinner==null){
          spinner= new Spinner(opts).spin(target)
        }
        else {
          spinner.spin(target)
        }
      }
